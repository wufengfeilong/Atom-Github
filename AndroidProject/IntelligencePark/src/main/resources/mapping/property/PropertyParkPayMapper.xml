<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="fcn.co.jp.park.mapper.property.PropertyParkPayMapper" >

    <insert id="addParkPayApply" parameterType="fcn.co.jp.park.util.PageData" >
        insert into t_parkPay
        (user_id,applicantName,company, phone,carNumber,applyType,onJobProImage,driverCardImage,driveringCardImage,
        startDate,endDate,parkStatus,paymentmoney,insert_user,insert_timestamp)
        values (#{userId,jdbcType=VARCHAR},#{applicantName,jdbcType=VARCHAR}, #{company,jdbcType=VARCHAR},
        #{phone,jdbcType=VARCHAR},#{carNumber,jdbcType=VARCHAR},#{applyType,jdbcType=INTEGER},
        #{onJobProImage,jdbcType=INTEGER},#{driverCardImage,jdbcType=INTEGER},#{driveringCardImage,jdbcType=INTEGER},
        #{startDate,jdbcType=VARCHAR},#{endDate,jdbcType=VARCHAR},#{parkStatus,jdbcType=INTEGER},
        #{money,jdbcType=INTEGER},#{userId,jdbcType=VARCHAR},now())
    </insert>

    <select id="getInitData" resultType="fcn.co.jp.park.util.PageData"
            parameterType="fcn.co.jp.park.util.PageData">
        select
        id, distinguish_id AS distinguishId, distinguish_name AS distinguishName, distinguish_value AS distinguishValue
        from m_distinguish
        where distinguish_key = #{TYPE,jdbcType=VARCHAR}
    </select>

    <select id="checkCarNumber"  parameterType="java.lang.String" resultType="java.lang.Integer">
        select
        count(*)
        from t_parkPay
        where carNumber = #{carNumber,jdbcType=VARCHAR} and applyType in("1")
    </select>

    <select id="getRejectInitData" resultType="fcn.co.jp.park.util.PageData"
            parameterType="fcn.co.jp.park.util.PageData">
        select
        applicantName,company,phone,carNumber,pic1.file_path as onJobProImagePath,pic2.file_path as driverCardImagePath,
        pic3.file_path as driveringCardImagePath,md.distinguish_name as applyTypeInfo,startDate,endDate,checkinfo
        from t_parkPay pp
				left join t_picture pic1 on(pic1.picture_id = pp.onJobProImage)
				left join t_picture pic2 on(pic2.picture_id = pp.driverCardImage)
				left join t_picture pic3 on(pic3.picture_id = pp.driveringCardImage)
				left join m_distinguish md on(md.id = pp.applyType)
        where pp.parkPay_id = #{parkPayId,jdbcType=INTEGER}
    </select>

</mapper>